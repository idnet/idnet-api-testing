<script type="text/javascript">
var site = '%%site%%';
$(document).ready(function() {
	var token = getHashParams().access_token;
	
	function api(url, data, method){
		var options = {
			type: method,
			url: site+url,
			headers: {'Authorization': 'Bearer ' + token},
			data: data,
			success: function(data, textStatus, jqXHR){display(jqXHR.responseText);},
			error: function( jqXHR, textStatus, errorThrown ){display(errorThrown+'<br>'+jqXHR.responseText);}
		};
		$.ajax(options);
		console.log(site+url+'?access_token='+token);
	}
	function getHashParams() {
		var hashParams = {};
		var e,
			a = /\+/g,  // Regex for replacing addition symbol with a space
			r = /([^&;=]+)=?([^&;]*)/g,
			d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
			q = window.location.hash.substring(1);

		while (e = r.exec(q))
			hashParams[d(e[1])] = d(e[2]);

			return hashParams;
	}
	function display(data){
		$('#status').html(data);
	}
	
	$('#profile1').click(function(e){
		api('api/v1/json/profile', null, 'GET');
	});
	$('#profile2').click(function(e){
		api('api/profile', null, 'GET');
	});
	$('#friends-simple').click(function(e){
		api('api/v1/json/'+$('#pid').val()+'/friends', null, 'GET');
	});
	$('#friends-all').click(function(e){
		api('api/v1/json/'+$('#pid').val()+'/friends-all', null, 'GET');
	});
	$('#friends').click(function(e){
		api('api/v1/json/links/friends', null, 'GET');
	});
	$('#follow').click(function(e){
		console.log($('#targetpid').val());
		api('api/v1/json/links/follow/'+$('#targetpid').val(), null, 'POST');
	});
	$('#appimage').click(function(e){
		api('api/v1/json/profile2/appimage/', null, 'POST');
	});
	$('#set').click(function(e){
		api('api/v1/json/user_data/submit', {key: 'save1', value: 'testest'}, 'POST');
	});
	$('#get').click(function(e){
		api('api/v1/json/user_data/retrieve', {key: 'save1'}, 'POST');
	});
	$('#chat-friends').click(function(e){
		api('api/v1/json/chat/list_friends', {}, 'POST');
	});
});
</script>
<div id="status" style="max-height:300px; overflow:hidden; border:1px solid #000; padding:20px;"></div>
<div id="profile1" class="link">Profile1</div>
<div id="profile2" class="link">Profile2</div>
<div id="friends-simple" class="link">Friends Simple</div>
<div id="friends-all" class="link">Friends All</div>
<div id="friends" class="link">Friends</div>
<div id="follow" class="link">Follow</div>
<div id="appimage" class="link">Post Profile Image</div>
<div id="set" class="link">Set User Data</div>
<div id="get" class="link">Get User Data</div>
<div id="chat-friends" class="link">Chat Friends (requires user data permission)</div>

<br>
Your pid for friend apis<br>
<input id="pid" value="Your pid" style="width:200px;"><br>
Target pid for friend api actions<br>
<input id="targetpid" value="target pid" style="width:200px;">





<a href="#" id="idnet-login">Login</a>
<a href="#" id="idnet-register">Register</a>

<script type="text/javascript" charset="utf-8">
	require(['id'], function(Main){
		Main(window);
		
		ID.init({
            appId: '5460f302e13823e4a8000002',
			redirectUri: 'http://localhost:2900/auth/idnet/callback',
			responseType: 'code'
		 });
	});
</script>
	
<script type="text/javascript">
$('#idnet-login').click(function(){
                ID.login(function(response){ console.log(response); } );
            });
            $('#idnet-register').click(function(){
                ID.register(idCallback);
            });
        // init the JS interface
        

</script>